<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Foil Apps Directory</title>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap">
    <style>
        :root {
            --background-color: #ffffff;
            --card-background: #ffffff;
            --text-color: #0f172a;
            --border-color: #e2e8f0;
            --hover-color: #f8fafc;
            --sport-chip-bg: #e5f4ff;
            --sport-chip-text: #0369a1;
            --platform-chip-bg: #ecfeff;
            --platform-chip-text: #0d9488;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--background-color);
            color: var(--text-color);
            line-height: 1.5;
            padding: 3rem 2rem;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 1.5rem;
        }

        .header-content {
            max-width: 600px;
        }

        .header-button {
            display: inline-flex;
            align-items: center;
            font-size: 1rem;
            font-weight: 500;
            color: #fff;
            background: #000;
            text-decoration: none;
            padding: 1rem 2rem;
            border-radius: 100px;
            transition: all 0.2s ease;
            margin-left: 2rem;
        }

        .header-button:hover {
            opacity: 0.9;
            transform: translateY(-1px);
        }

        h1 {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 0.75rem;
            letter-spacing: -0.02em;
            line-height: 1.2;
        }

        .subtitle {
            font-size: 1.125rem;
            color: #64748b;
            margin-bottom: 1.5rem;
            max-width: 600px;
        }

        .filter-container {
            margin-bottom: 1rem;
            display: flex;
            gap: 2rem;
            align-items: flex-start;
        }

        .sticky-wrapper {
            position: sticky;
            top: 0;
            background: var(--background-color);
            padding: 1rem 0;
            z-index: 100;
            margin: -1rem 0;
            transition: box-shadow 0.2s ease;
        }

        .sticky-wrapper.is-sticky {
            box-shadow: 0 8px 16px -8px rgba(0, 0, 0, 0.1);
        }

        .filter-section {
            margin-bottom: 0;
            flex: 1;
        }

        .filter-section > div {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
        }

        .filter-label {
            font-size: 0.75rem;
            color: #64748b;
            margin-bottom: 0.375rem;
            display: block;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .filter-button {
            display: inline-block;
            padding: 0.5rem 1rem;
            font-size: 0.875rem;
            font-weight: 500;
            color: #64748b;
            background: transparent;
            border: 1px solid #e2e8f0;
            border-radius: 100px;
            cursor: pointer;
            transition: all 0.2s ease;
            margin: 0;
        }

        .filter-button:hover {
            border-color: #0369a1;
            color: #0369a1;
        }

        .filter-button.active {
            background: #0369a1;
            color: white;
            border-color: #0369a1;
        }

        .results-counter {
            font-size: 0.875rem;
            color: #64748b;
        }

        .results-counter strong {
            color: #0f172a;
            font-weight: 500;
        }

        .apps-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 2.5rem;
            margin-bottom: 4rem;
            padding-top: 1rem;
        }

        .app-card {
            background: var(--card-background);
            padding: 2.5rem;
            border-radius: 1.5rem;
            border: 1px solid var(--border-color);
            transition: all 0.3s ease;
            display: flex;
            flex-direction: column;
            height: 100%;
            position: relative;
            overflow: hidden;
        }

        .app-card:hover {
            border-color: #000;
        }

        .app-card h2 {
            font-size: 1.75rem;
            font-weight: 600;
            margin-bottom: 1.5rem;
            letter-spacing: -0.02em;
        }

        .app-card .chips-container {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            margin-bottom: 0.75rem;
        }

        .app-card .chips-container:last-of-type {
            margin-bottom: 1.5rem;
        }

        .app-card .chip {
            display: inline-flex;
            align-items: center;
            font-size: 0.75rem;
            font-weight: 500;
            letter-spacing: 0.02em;
            padding: 0.375rem 0.75rem;
            border-radius: 100px;
            line-height: 1;
        }

        .app-card .chip.sport {
            background-color: var(--sport-chip-bg);
            color: var(--sport-chip-text);
        }

        .app-card .chip.platform {
            background-color: var(--platform-chip-bg);
            color: var(--platform-chip-text);
        }

        .app-card .description {
            font-size: 1rem;
            margin-bottom: 2rem;
            color: #334155;
            flex-grow: 1;
            line-height: 1.7;
        }

        .app-card a {
            display: inline-flex;
            align-items: center;
            font-size: 1rem;
            font-weight: 500;
            color: #000;
            text-decoration: none;
            padding: 0.75rem 0;
            transition: all 0.2s ease;
            margin-top: auto;
            border-bottom: none;
        }

        .app-card a:after {
            content: "â†’";
            margin-left: 0.5rem;
            transition: transform 0.2s ease;
        }

        .app-card a:hover:after {
            transform: translateX(4px);
        }

        .add-app {
            margin-top: 4rem;
            padding: 3rem;
            background: var(--hover-color);
            border-radius: 1.5rem;
            text-align: center;
            margin-bottom: 4rem;
        }

        .add-app h2 {
            font-size: 2rem;
            font-weight: 600;
            margin-bottom: 1rem;
            letter-spacing: -0.02em;
        }

        .add-app p {
            font-size: 1.125rem;
            color: #64748b;
            margin-bottom: 2rem;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
        }

        .add-app a {
            display: inline-flex;
            align-items: center;
            font-size: 1rem;
            font-weight: 500;
            color: #fff;
            background: #000;
            text-decoration: none;
            padding: 1rem 2rem;
            border-radius: 100px;
            transition: all 0.2s ease;
        }

        .add-app a:hover {
            opacity: 0.9;
            transform: translateY(-1px);
        }

        .footer {
            text-align: center;
            padding: 2rem 0;
            border-top: 1px solid var(--border-color);
            color: #64748b;
            font-size: 0.875rem;
        }

        .footer a {
            color: #0369a1;
            text-decoration: none;
            font-weight: 500;
        }

        .footer a:hover {
            text-decoration: underline;
        }

        .heart {
            color: #ff0000;
            display: inline-block;
            animation: heartBeat 1s infinite;
        }

        @keyframes heartBeat {
            0% { transform: scale(1); }
            50% { transform: scale(1.2); }
            100% { transform: scale(1); }
        }

        html {
            scroll-behavior: smooth;
        }

        @media (max-width: 768px) {
            body {
                padding: 1.5rem 1rem;
            }

            .header {
                flex-direction: column;
                align-items: stretch;
                gap: 1.5rem;
            }

            .header-button {
                margin-left: 0;
                text-align: center;
                justify-content: center;
            }

            h1 {
                font-size: 2rem;
            }

            .filter-container {
                flex-direction: column;
                gap: 1rem;
            }

            .filter-section {
                width: 100%;
            }

            .filter-section > div {
                gap: 0.375rem;
            }

            .filter-button {
                flex: 0 1 auto;
                font-size: 0.8125rem;
                padding: 0.375rem 0.75rem;
            }

            .apps-grid {
                grid-template-columns: 1fr;
            }

            .app-card {
                padding: 2rem;
            }

            .add-app {
                margin-top: 3rem;
                padding: 2rem;
            }

            .add-app h2 {
                font-size: 1.5rem;
            }

            .footer {
                padding: 1.5rem 0;
                font-size: 0.8125rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header class="header">
            <h1>Foil Apps Directory</h1>
            <a href="#add-app" class="header-button">Add App</a>
        </header>

        <div class="sticky-wrapper">
            <div class="filter-container">
                <div class="filter-section">
                    <span class="filter-label">Filter by Sport</span>
                    <div>
                        <button class="filter-button active" data-filter="sport-all">All</button>
                        <button class="filter-button" data-filter="sport-Wingfoil">Wing</button>
                        <button class="filter-button" data-filter="sport-Kitefoiling">Kite</button>
                        <button class="filter-button" data-filter="sport-pumpfoil">Pump</button>
                        <button class="filter-button" data-filter="sport-eFoil">eFoil</button>
                    </div>
                </div>
                <div class="filter-section">
                    <span class="filter-label">Filter by Platform</span>
                    <div>
                        <button class="filter-button active" data-filter="platform-all">All</button>
                        <button class="filter-button" data-filter="platform-iOS">iOS</button>
                        <button class="filter-button" data-filter="platform-Android">Android</button>
                        <button class="filter-button" data-filter="platform-Apple Watch">Apple Watch</button>
                        <button class="filter-button" data-filter="platform-Android Watch">Android Watch</button>
                        <button class="filter-button" data-filter="platform-Garmin">Garmin</button>
                        <button class="filter-button" data-filter="platform-web">Web</button>
                        <button class="filter-button" data-filter="Hardware">Hardware</button>
                    </div>
                </div>
            </div>
            <div class="results-counter"></div>
        </div>

        <div class="apps-grid">
            <!-- Apps will be loaded here -->
        </div>

        <div id="add-app" class="add-app">
            <h2>Want to add your app?</h2>
            <p>Join our directory of foiling apps. Submit your app through our GitHub repository and reach the foiling community.</p>
            <a href="https://github.com/pfederi/foilapps" target="_blank">Submit on GitHub</a>
        </div>

        <footer class="footer">
            This is an open source project. View the code and contribute on <a href="https://github.com/pfederi/foilapps" target="_blank">GitHub</a>.<br>
            Made with <span class="heart">â™¥</span> by <a href="https://lakeshorestudios.ch" target="_blank">Lakeshore Studios</a>
        </footer>
    </div>

    <script>
        let appsData = [];
        let currentFilters = {
            sport: 'all',
            platform: 'all'
        };

        // Sport name mapping for normalization
        const sportMapping = {
            'wing': ['wingfoil', 'wingfoiling', 'wing'],
            'kite': ['kitefoil', 'kitefoiling', 'kite'],
            'pump': ['pumpfoil', 'pump', 'pump surf'],
            'efoil': ['efoil', 'electric foil'],
            'surf': ['surffoil', 'surf'],
            'downwind': ['downwindfoil', 'downwind']
        };

        // Get normalized sport name
        function getNormalizedSport(sport) {
            sport = sport.toLowerCase().trim();
            // Skip generic categories
            if (['foil', 'hydrofoil'].includes(sport)) return null;
            
            for (const [normalized, variations] of Object.entries(sportMapping)) {
                if (variations.includes(sport)) {
                    return normalized;
                }
            }
            return sport; // Return original if no mapping found
        }

        // Get unique sports from apps data
        function getUniqueSports(apps) {
            const sports = new Set();
            apps.forEach(app => {
                app.sport.forEach(sport => {
                    const normalizedSport = getNormalizedSport(sport);
                    if (normalizedSport) { // Only add if not null (skip 'foil')
                        sports.add(normalizedSport);
                    }
                });
            });
            return Array.from(sports).sort();
        }

        // Update sport filter buttons
        function updateSportFilters(sports) {
            const sportFiltersContainer = document.querySelector('.filter-section:first-child div');
            sportFiltersContainer.innerHTML = `
                <button class="filter-button active" data-filter="sport-all">All</button>
                ${sports.map(sport => `
                    <button class="filter-button" data-filter="sport-${sport}">
                        ${sport.charAt(0).toUpperCase() + sport.slice(1)}
                    </button>
                `).join('')}
            `;
        }

        async function loadApps() {
            try {
                console.log('Fetching apps.json...');
                const response = await fetch('apps.json');
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                console.log('Parsing JSON...');
                const data = await response.json();
                console.log('Data loaded:', data);
                
                if (data && data.apps && Array.isArray(data.apps)) {
                    appsData = data.apps;
                    const uniqueSports = getUniqueSports(appsData);
                    updateSportFilters(uniqueSports);
                    renderApps();
                    addFilterEventListeners();
                } else {
                    console.error('Invalid data format in apps.json:', data);
                    document.querySelector('.apps-grid').innerHTML = '<p>Error: Invalid data format in apps.json</p>';
                }
            } catch (error) {
                console.error('Error loading apps:', error);
                document.querySelector('.apps-grid').innerHTML = `<p>Error loading apps: ${error.message}</p>`;
            }
        }

        function renderApps() {
            const container = document.querySelector('.apps-grid');
            let filteredApps = appsData;

            // Apply sport filter
            if (currentFilters.sport !== 'all') {
                filteredApps = filteredApps.filter(app => 
                    app.sport.some(sport => {
                        const normalizedSport = getNormalizedSport(sport);
                        return normalizedSport && normalizedSport === currentFilters.sport;
                    })
                );
            }

            // Apply platform filter
            if (currentFilters.platform !== 'all') {
                filteredApps = filteredApps.filter(app => 
                    app.platforms.map(p => p.toLowerCase()).includes(currentFilters.platform.toLowerCase())
                );
            }

            // Update counter
            const counterText = filteredApps.length === appsData.length 
                ? `Showing all <strong>${filteredApps.length}</strong> apps`
                : `Showing <strong>${filteredApps.length}</strong> of <strong>${appsData.length}</strong> apps`;
            document.querySelector('.results-counter').innerHTML = counterText;

            container.innerHTML = filteredApps.map(app => `
                <div class="app-card">
                    <h2>${app.name}</h2>
                    <div class="chips-container">
                        ${app.sport.map(sport => {
                            const normalizedSport = getNormalizedSport(sport);
                            return normalizedSport ? `
                                <span class="chip sport">${normalizedSport}</span>
                            ` : '';
                        }).join('')}
                    </div>
                    <div class="chips-container">
                        ${app.platforms.map(platform => `
                            <span class="chip platform">${platform.toLowerCase()}</span>
                        `).join('')}
                    </div>
                    <p class="description">${app.description}</p>
                    <a href="${app.url}" target="_blank">Visit App</a>
                </div>
            `).join('');
        }

        function addFilterEventListeners() {
            const filterButtons = document.querySelectorAll('.filter-button');
            filterButtons.forEach(button => {
                button.addEventListener('click', () => {
                    const [type, value] = button.dataset.filter.split('-');
                    
                    // Remove active class from buttons in the same category
                    document.querySelectorAll(`[data-filter^="${type}-"]`)
                        .forEach(btn => btn.classList.remove('active'));
                    
                    // Add active class to clicked button
                    button.classList.add('active');
                    
                    // Update filters
                    currentFilters[type] = value;
                    
                    // Apply filters
                    renderApps();
                });
            });
        }

        // Initialize app
        document.addEventListener('DOMContentLoaded', () => {
            loadApps();
        });

        // Sticky filter functionality
        const stickyWrapper = document.querySelector('.sticky-wrapper');
        const appsGrid = document.querySelector('.apps-grid');
        let lastScrollTop = 0;
        
        window.addEventListener('scroll', () => {
            const filterRect = stickyWrapper.getBoundingClientRect();
            const scrollTop = window.pageYOffset || document.documentElement.scrollTop;
            const isScrollingDown = scrollTop > lastScrollTop;
            
            // Only add shadow when the filter is actually stuck to the top
            if (isScrollingDown && filterRect.top === 0) {
                stickyWrapper.classList.add('is-sticky');
            } else {
                stickyWrapper.classList.remove('is-sticky');
            }
            
            lastScrollTop = scrollTop;
        });
    </script>
</body>
</html>